<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300' rel='stylesheet' type='text/css'>
  <link href='qsr.css' rel='stylesheet' type='text/css'>
  <script src="https://d3js.org/d3.v4.min.js"></script>
<!-- then some style tags-->

</head>
<body>
<div id="qsr-chart">
<script>

/* select what csv should be run */
var csv_url = "https://couchux.github.io/BAMA-MSU_SRbyQuarter.csv"

/* tie chart colors to team names */
var teamColors = {
  "Alabama": "#C31C45",
  "Michigan State": "#205649"
}
    gameColor = "#4A4A4A"

teamColor = function(team_name) {
  return teamColors[team_name]
};

/* defining the main chart functions */

function qsrChart(data_url, which_team) {
  d3.csv(data_url, csv_response.bind(null, which_team))
}

function csv_response(which_team, error, data) {
  if (error) {
    console.error(error)
  }
  else {
    console.log("data loaded")
    qsrData = data.filter(function(row){
      return row.Team == which_team  //try to Filter/reformat ("Transform") outside of data pull
    })
    render_teamTitle(which_team)
    render_chart()
  }
}

/* building the chart in d3 */

function render_teamTitle(which_team) {
  var teamTitle = d3.select("#qsr-chart")
      .insert("p")
      .text(which_team)
      .style("color",teamColor(which_team))
      .attr("class","teamTitle")
  }

function render_chart() {

var layout = {
  svgWidth: document.getElementById("qsr-chart").offsetWidth,
  barHeight: 36,
  barMarginBoost: 1.1,
  srWidthScale: 0.75,
  leagueSR: 0.42, //update this peridically for NCAA Success Rate averages
}

var barHeightMulti = layout.barHeight * layout.barMarginBoost
    maxIndex = d3.max(qsrData, function(d,i) { return (i + 1) });
    maxSR = d3.max(qsrData, function(d,i) { return d.SuccessRate })
    svgHeight = maxIndex * barHeightMulti
    srBarWidth = function(d,i) {return d.SuccessRate / maxSR * layout.svgWidth * layout.srWidthScale}

var format = {
  percent: d3.format(".0%")
}

var svg = d3.select("#qsr-chart")
    .append("svg")
    .attr("width",layout.svgWidth)
    .attr("height",svgHeight)

    backBars = svg.selectAll(".backBar").data(qsrData).enter()
    .append("rect")
    .attr("class","backBar")
    .attr("width",layout.svgWidth)
    .attr("height",layout.barHeight)
    .attr("y",function(d,i) { return i * barHeightMulti })

    srBars = svg.selectAll(".srBar").data(qsrData).enter()
    .append("rect")
    .attr("class","backBar")
    .attr("width",srBarWidth)
    .attr("height",layout.barHeight)
    .attr("y",function(d,i) { return i * barHeightMulti })
    .style("fill",function(d) {
      if ( d.Quarter === "Game") {
        return gameColor
      }
      else {
        return teamColor(d.Team)
      }
    })


}

/* run the whole chart function */
qsrChart(csv_url, "Alabama"); //the latter part doesn't do anything, but I'd like to control the team from here
qsrChart(csv_url, "Michigan State");

</script>
</div>
</body>
</html>
